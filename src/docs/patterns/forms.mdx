import { DemoCard, ImageGrid, MaterialDesignDescription, Divider } from '../../app/components';
import SummaryImage from '../../app/assets/design-patterns/form-validation/form-validation.svg';
import Image4 from '../../app/assets/design-patterns/form-validation/form-validation-password-entering.png';
import Image5 from '../../app/assets/design-patterns/form-validation/form-validation-password-error.png';
import Image6 from '../../app/assets/design-patterns/form-validation/form-validation-password-complete.png';

import LongFormImage from '../../app/assets/design-patterns/form-validation/long-form.png';
import OnBlurImage from '../../app/assets/design-patterns/form-validation/verify-input-on-blur.png';
import OnChangeImage from '../../app/assets/design-patterns/form-validation/verify-input-on-change.png';
import OnPageChangeImage from '../../app/assets/design-patterns/form-validation/verify-input-on-page-change.png';
import SubmitButtonLocationImage from '../../app/assets/design-patterns/form-validation/submit-button-location.png';
import NextButtonUsageImage from '../../app/assets/design-patterns/form-validation/next-button-usage.png';
import SubmitButtonOnChangeImage from '../../app/assets/design-patterns/form-validation/submit-button-on-change.png';
import SubmitButtonAutoSubmitImage from '../../app/assets/design-patterns/form-validation/submit-button-auto-submit.png';
import SubmitButtonOnBlurImage from '../../app/assets/design-patterns/form-validation/submit-button-on-blur.png';
import SubmitButtonOnClickImage from '../../app/assets/design-patterns/form-validation/submit-button-on-click.png';
import Specs1Image from '../../app/assets/design-patterns/form-validation/specs-1.png';
import Specs2Image from '../../app/assets/design-patterns/form-validation/specs-2.png';
import Specs3Image from '../../app/assets/design-patterns/form-validation/specs-3.png';
import Specs4Image from '../../app/assets/design-patterns/form-validation/specs-4.png';
import Specs5Image from '../../app/assets/design-patterns/form-validation/specs-5.png';

import dismissKeyboardErrorAutoscrollImage from '../../app/assets/design-patterns/form-validation/dismiss-keyboard-error-autoscroll.gif';
import dismissKeyboardErrorTextImage from '../../app/assets/design-patterns/form-validation/dismiss-keyboard-error-text.gif';

<!-- KEYWORDS: design pattern form verification validation error -->

# Forms and Validation

<ImageGrid images={[SummaryImage]} regularWidth />

Forms are an integral part of many applications, particularly during the [user registration](/patterns/user-auth) phase. One of the most important parts of working with forms is properly validating the information that users enter into them. In general, PX Blue follows the form behaviors explained in detail by Material Design.

<React.Fragment>
    <MaterialDesignDescription title={'Text Fields'} url={'https://material.io/components/text-fields/'} />
    <DemoCard
        repository={'form-validation'}
        angular={
            'https://stackblitz.com/github/pxblue/angular-design-patterns?file=src%2Fapp%2Fpages%2Fform-validation%2Fform-validation.component.ts'
        }
        react={
            'https://codesandbox.io/s/github/pxblue/react-design-patterns/tree/master?file=/src/pages/form-validation/index.tsx&initialpath=form-validation'
        }
    />
    <Divider />
</React.Fragment>

# Anatomy

## Form Layout

Keep your forms short where possible, but make effective use of whitespace to avoid overwhelming your users. If your forms are larger than the height of your target device, consider breaking them into sections or multiple pages to improve the user experience.

<ImageGrid
    images={[LongFormImage]}
    regularWidth
    caption={
        'You can either split the forms into sections with dividers (#1) or into multiple pages with steppers (#2), or a combination of both.'
    }
/>

<!--
## Input Controls

When using multiple input controls, such as text fields, radio buttons, checkboxes, try to keep all of your inputs in a single column to preserve the sense of a linear progression. Inputs should be approximately as wide as their expected input values (or full width on mobile). Follow the Material Design [guidelines](https://material.io/components/selection-controls#specs) for when to use different selection controls.
 -->

## Field Requirements

Required / optional fields should be identified according to the Material Design guidelines. If your form fields have complex requirements for valid values, you can list these criteria below the input. A common use case for this is when displaying password complexity requirements.

<ImageGrid images={[Image4, Image5, Image6]} caption={'A common application of form validation — reset password.'} />

## Error Messages

If there is an error with the data entered into a field, the field should indicate to the user that there is a problem. Label and helper text should be changed to a red color and the error message should be displayed in the helper text location below the field — any existing helper text should be replaced with the error message. You may optionally show an additional error icon in the text input.

Error messages should be succinct and should not provide information that could compromise security (e.g., use "Invalid Credentials" instead of "Incorrect Password").

## Success Screens

Once a user has reached the end of a form successfully, you should present them with a success screen. This screen should indicate to the user that their submission was accepted and offer information about the next steps (e.g., "Click the finish button below to log in."). Typically these success screens are stylized for your application and will include some bold graphics or [illustrations](/style/illustrations).

## Mobile Keyboard

Mobile devices offer multiple different software keyboard variations for different types of inputs. Make sure that you are using the appropriate keyboard for your inputs (e.g., use the email keyboard for email inputs, phone number keyboard for a phone number field, etc.).

Typically, mobile devices also allow you to change the label on the return key of the software keyboard. This label should be appropriate to the context (see [Submitting the Form](/patterns/forms#submitting-the-form) below).

The focused input field should remain centered in the screen when the software keyboard is open — it should not be hidden behind the keyboard.

## Password Visibility

Depending on the security requirements of your application, it may be useful to add a password visibility toggle button to fields where users must enter a password (such as during login or changing a password). The visibility toggle switches the input type between hidden text and plain text so users can ensure that they typed their password correctly.

<Divider />

# Behaviors

## Verifying User Input

In general, there are three acceptable times to perform form field verification:

-   on blur: the field is verified when the user clicks away from it
-   on change: the field is dynamically verified on each keystroke or change in the value
-   on action: fields are verified after performing a specific action, such as clicking a button

### Verifying on Blur

In order to avoid distracting or confusing users, most text fields should verify input when the field loses focus. Error messages should not appear until the user is finished entering data and the field is no longer in focus.

<ImageGrid
    images={[OnBlurImage]}
    regularWidth
    caption={[
        '1: Do not check for validity or display error messages when the user is typing in the field.',
        '2: The user is finished and the input has lost focus (i.e., "blurred"). Now the input should be verified.',
    ]}
/>

### Verifying on Change

Some fields should verify the user input as it changes. The most common case for this type of verification is a new password field or a confirm password field. The verification feedback should be displayed / updated each time the user makes a change to the input field.

<ImageGrid
    images={[OnChangeImage]}
    regularWidth
    caption={[
        '1: The password criteria checks shall be updated as the user changes their input.',
        '2: “Confirm Password” field should check for a match with password to give immediate feedback for when the user can proceed.',
    ]}
/>

### Verifying on Action

In some specific situations, you may need to defer verification or perform it for all fields in a form at once. In this case, you need to link verification to a specific action, such as clicking a button.

This type of verification is common when the checks cannot be performed on the client, such as making an API call to verify a registration code, check user login credentials, or search for a device on the network. In most cases, you can do some preliminary checks using one of the two methods above (e.g., you can check if the email is a valid email before making the API call to verify the credentials).

If verification is being triggered by clicking on a button, you should replace the button text with a loading spinner while the verification is in progress. If the verification is successful, the user should be automatically taken to the next screen.

<ImageGrid
    images={[OnPageChangeImage]}
    regularWidth
    caption={[
        'After the user clicks the submit button, the app waits for the server response, and displays an error message.',
        '1: The helper text will be replaced by the error message. ',
        '2: Use a circular progress indicator when waiting for responses from the server.',
    ]}
/>

## Submitting the Form

Forms should have a button to submit the data or continue to the next part of the form if there are multiple parts. Depending on what happens next, the button should be labeled _Next_, _Finish_, or similar. The button should be located at the bottom right corner of the form (bottom left for right-to-left languages).

<ImageGrid
    images={[SubmitButtonLocationImage]}
    regularWidth
    caption={[
        '1: On desktops, the button is placed in the bottom corner of the form.',
        '2: On mobile, the software keyboard has different options for the action button',
    ]}
/>

On mobile, if there are multiple input fields on the screen, the keyboard action button should say "next", unless you are on the last item of the page, in which case the keyboard button should say "done" or "submit". This button can either submit the form or simply dismiss the keyboard (if you want users to have a chance to review their information first).

<ImageGrid
    images={[NextButtonUsageImage]}
    regularWidth
    caption={[
        ,
        '1: The user entered a valid input. Clicking "next" will auto-focus the user to the next text field.',
        '2: The user entered an invalid input. Clicking "next" will display the error message but will not auto-focus to the next text field.',
    ]}
/>

For screens where there is a single field with a known required length (e.g., a verification code), the submit button can be omitted and the form submitted as soon as the required length is reached.

<!-- TODO: A gif might handle the task better here -->

<ImageGrid
    images={[SubmitButtonAutoSubmitImage]}
    regularWidth
    caption={
        'For the verification code screen, you can auto-submit the information once the user input reaches the required length (#2). After the verification code is recognized (#3), the screen pauses for a short moment before automatically moving to the next screen.'
    }
/>

### Disabling the Submit Button

If there are errors indicated on any of the form fields, the submit button should be disabled. If you are performing verification when clicking the submit button (onAction), all the invalid fields should be indicated if they aren't already.

<React.Fragment>
    {/* <ImageGrid
        images={[SubmitButtonOnChangeImage]}
        regularWidth
        caption={
            'When your input field field is verified on change, disable the submit button until the user enters a valid input.'
        }
    /> */}
    <ImageGrid
        images={[SubmitButtonOnBlurImage]}
        regularWidth
        caption={'The submit button is disabled until the user has entered something for all the required fields.'}
    />
    <ImageGrid
        images={[dismissKeyboardErrorAutoscrollImage, dismissKeyboardErrorTextImage]}
        caption={[
            '1: The UI should auto-scroll to and focus on the first invalid field.',
            '2: On login screens, form fields should not shift when errors appear.',
        ]}
    />
</React.Fragment>
<Divider />

# Design Specifications

For additional instructions, refer to Material Design's [specifications](https://material.io/components/text-fields#specs) for "Text fields".

## Mobile

<ImageGrid images={[Specs1Image, Specs2Image, Specs3Image]} regularWidth />

## Desktop and Tablet

If certain dimensions are not specified, refer to the dimensions suggested in the mobile section above.

<ImageGrid images={[Specs4Image, Specs5Image]} regularWidth />
<Divider />

# Developers

Use the following components to implement this pattern:

**Angular** — Angular Material

-   [Form Field](https://material.angular.io/components/form-field/overview)
-   [Input](https://material.angular.io/components/input/overview)

**React** — Material-UI

-   [Text Field](https://material-ui.com/components/text-fields/#text-field)

**React Native** — React-Native-Paper

-   [TextInput](https://callstack.github.io/react-native-paper/text-input.html)
